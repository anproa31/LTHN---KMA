	AREA CS16_CS2,CODE,READONLY
	
;=====================
H16_H2 PROC
	LDRB R0,SPT16 ;R0 = 4
	LDR R1,=Coso16 ;DIA CHI DAU TIEN
	ADD R1,R0 ; CHAY DEN DIA CHI CUOI CUNG
	SUB R1,#1 ;GIAM 1
	LDR R2, =Coso1602
	ADD R2,#100 ;CAP NHAT DIA CHI DE LUU NGUOC
	MOV R4,#2 ;DUNG DE CHIA CO SO
LOOP	
	CMP R0,#0 ;KIEM TRA R0 VOI 0
	BEQ STOP1 ; BANG 0 THI DUNG
	LDRB R3,[R1],#-1 ;GIA TRI R3 BANG DIA CHI R1 -1
	MOV R7,#4 ;MOT DU LIEU DC DOC VAO 4 BYTE THAY CHO 4 BIT
	
LOOP1	
	UDIV R5,R3,R4 ;CHIA LAY THUONG VD 15/2 = 7 DU 1 HOAC 18/2 = 9 DU 0
	MUL R6,R5,R4 ; DUNG PHEP NHAN DE LAY SO DU VD 7x2 = 14 => 15-14 du 1
	SUB R3,R6 ; KET QUA CUA PHEP SUB LA SO DU CO THE LA 1 HOAC 0
	STRB R3,[R2],#-1 ;GIA TRI R3 SE DC GAN VAO DIA CHI CUOI CUNG CUA CHUOI
	SUB R7,#1 ;GIAM DI 1 VI F = 1111 TA DC SO DAU TIEN LA 1 HOAC 0 SUY RA CON 111 CHIA DC CHO VAO
	CMP R5,#0 ;KIEM TRA XEM DA CHIA HET CHUA
	MOV R3,R5 ;GAN GT R5 VAO R3 DE TIEP TUC CHIA
	BGT LOOP1 ;TIEP TUC CHIA NEU > 0
	CMP R7,#0 ; KIEM TRA CHO DEN KHI NAO R7 = 0 CO NGHIA LA DA DU 4 BYTE
	BEQ NEXT1 ; BANG THI GIA R0 DI 1 DE TIEP TUC SO TIEP THEO
SAVE1
	STRB R5,[R2],#-1 ;NEU MA CHIA HET MA R7 VAN CHUA BANG 0 THI TA TRU CHO DEN KHI R7 = 0
	SUB R7,#1 ; VD NHU 0001 LA CHIA DEN 1 LA HET CON 000 THI SE DUNG CAI NAY
	CMP R7,#0
	BGT SAVE1 ; LUU VAO KHIA CHIA HET THI NEXT XUONG
	
	
NEXT1
	SUB R0,#1 ;TIEP TUC CHO KI TU TIEP THEO
	B LOOP
	
STOP1	
	B THOAT
	BX LR
	ENDP
;=====================
	END